<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="5.0.0">
<title>Build Test Data Users Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Build Test Data Users Guide</h1>
<div class="details">
<span id="author" class="author">5.0.0</span><br>
<span id="revnumber">version 5.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#release-history">Release History</a></li>
</ul>
</li>
<li><a href="#methodology">Methodology</a>
<ul class="sectlevel2">
<li><a href="#manual-data-creation">Manual Data Creation</a></li>
<li><a href="#test-fixtures">Test Fixtures</a></li>
</ul>
</li>
<li><a href="#features">Features</a>
<ul class="sectlevel2">
<li><a href="#supported-constraints">Supported Constraints</a></li>
<li><a href="#unsupported-constraints">Unsupported Constraints</a></li>
</ul>
</li>
<li><a href="#installation">Installation</a>
<ul class="sectlevel2">
<li><a href="#grails-5-0-or-later">Grails 5.0 or later</a></li>
<li><a href="#grails-4-0">Grails 4.0</a></li>
<li><a href="#grails-3-3">Grails 3.3</a></li>
<li><a href="#grails-3-1-and-3-2">Grails 3.1 and 3.2</a></li>
<li><a href="#grails-2-x">Grails 2.x</a></li>
</ul>
</li>
<li><a href="#upgrading">Upgrading</a>
<ul class="sectlevel2">
<li><a href="#performance-improvements">Performance Improvements</a></li>
<li><a href="#abstract-classes">Abstract Classes</a></li>
<li><a href="#config-parameters">Config Parameters</a></li>
<li><a href="#disabling-via-testdataconfig">Disabling Via TestDataConfig</a></li>
<li><a href="#build-methods-refactored">Build methods refactored</a></li>
<li><a href="#unit-tests">Unit Tests</a></li>
<li><a href="#integration-tests">Integration Tests</a></li>
</ul>
</li>
<li><a href="#usage">Usage</a>
<ul class="sectlevel2">
<li><a href="#simple-application-example">Simple Application Example</a></li>
<li><a href="#build">build()</a></li>
<li><a href="#findorbuild">findOrBuild()</a></li>
<li><a href="#buildsave-false">build(save: false)</a></li>
</ul>
</li>
<li><a href="#unittesting">Unit Testing</a>
<ul class="sectlevel2">
<li><a href="#using-build">Using @Build</a></li>
<li><a href="#trait-methods">Trait Methods</a></li>
<li><a href="#hibernatespec-multi-tenant">HibernateSpec Multi-Tenant</a></li>
</ul>
</li>
<li><a href="#integrationtesting">Integration Testing</a>
<ul class="sectlevel2">
<li><a href="#using-build-annotation">Using Build Annotation</a></li>
</ul>
</li>
<li><a href="#testdataconfig">Test Data Config</a>
<ul class="sectlevel2">
<li><a href="#test-specific-config">Test Specific Config</a></li>
<li><a href="#generating-dynamic-values">Generating Dynamic Values</a></li>
<li><a href="#specifying-additional-dependencies">Specifying Additional Dependencies</a></li>
<li><a href="#building-abstract-classes">Building Abstract Classes</a></li>
<li><a href="#using-a-different-name-for-testdataconfig-groovy">Using a different name for TestDataConfig.groovy</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a>
<ul class="sectlevel2">
<li><a href="#working-with-unique-constraints">Working with Unique Constraints</a></li>
<li><a href="#building-objects-and-building-associated-child-objects">Building Objects and Building Associated Child Objects</a></li>
<li><a href="#assigning-system-wide-default-values">Assigning System Wide Default Values</a></li>
<li><a href="#logging-information">Logging Information</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating maintainable test data is hard. Often an entire object graph needs to be created to support the instantiation of a single domain object. This leads to either the cutting and pasting of that creation code, or relying on a canned set of objects that we&#8217;ve grown over time and maintained as the domain objects change. After a while, adding just one more widget to that set of canned data ends up breaking tests just about every time.</p>
</div>
<div class="paragraph">
<p>There has to be a better solution, right?</p>
</div>
<div class="paragraph">
<p>Yep! Due to the power and the glory of Grails, we have a lot of metadata at our fingertips about those domain objects. We know what constraints we&#8217;ve placed on our objects, and which objects depend on other objects to live.</p>
</div>
<div class="paragraph">
<p>Using this additional information, we&#8217;ve created a grails plugin that makes it easy to just provide those values that you want to exercise under test and not worry about the rest of the object graph that you need to create just to instantiate your domain objects.</p>
</div>
<div class="paragraph">
<p>Once installed, all you have to do is call the new "build" method on your domain class and you&#8217;ll be given a valid instance with all of the required constraints given values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> author = Author.build(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ted Naleid</span><span class="delimiter">'</span></span>)
<span class="comment">//or</span>
<span class="keyword">def</span> author = TestData.build(Author, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ted Naleid</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="release-history">Release History</h3>
<div class="ulist">
<ul>
<li>
<p>January 6th, 2018 - 3.3.0.RC1</p>
<div class="ulist">
<ul>
<li>
<p>Support for Grails 3.3.x</p>
</li>
<li>
<p>Major cleanup and performance improvements</p>
</li>
<li>
<p>Trait based API</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 7th, 2018 - 3.3.0</p>
<div class="ulist">
<ul>
<li>
<p>Official release</p>
</li>
<li>
<p>Minor bug fixes from release candidate</p>
</li>
</ul>
</div>
</li>
<li>
<p>June 1st, 2018 - 3.3.1</p>
<div class="ulist">
<ul>
<li>
<p>Support building of any nested <code>Validateable</code></p>
</li>
<li>
<p>Fix misc data binding issues</p>
</li>
<li>
<p>Fix build issues with Basic to-many collections</p>
</li>
<li>
<p>Add 2nd <code>obj</code> parameter to TestDataConfig closures</p>
</li>
<li>
<p>Other minor bug fixes and cleanup</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="methodology">Methodology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Over the years, a number of different methods for creating and maintaining testing data have been tried.  Here&#8217;s a subset of the solutions along with some pros/cons to each of them.</p>
</div>
<div class="sect2">
<h3 id="manual-data-creation">Manual Data Creation</h3>
<div class="paragraph">
<p>Creating testing data for integration tests has gone through an evolution over the years.</p>
</div>
<div class="paragraph">
<p>It first started with all of the test data being constructed right in the body of the test method, leading to a lot of cut and paste when you hit another method.</p>
</div>
<div class="sect3">
<h4 id="strengths">Strengths</h4>
<div class="ulist">
<ul>
<li>
<p>the code that defines the objects under test is right next to the code that uses those objects in test.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="weaknesses">Weaknesses</h4>
<div class="ulist">
<ul>
<li>
<p>If the objects under test rely on other objects, it can be necessary to create a large graph of objects in your test method</p>
</li>
<li>
<p>Not at all DRY, cutting and pasting leads to errors and extra code that you don&#8217;t need</p>
</li>
<li>
<p>When you add a new method to an existing object (or change/delete an existing one), you need to change all of the cut/pasted lines in all of the test methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JUnit (and other xUnit) testing frameworks DRYed this up by having a "setUp" method that gets called for all test methods, but this requires you to share data across all of the tests in the test class and you&#8217;re still manually creating it in each test</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test-fixtures">Test Fixtures</h3>
<div class="paragraph">
<p>Text fixtures allow you to use a DSL to define a named object graph.  You can then refer to this object graph in a test to have the fixtures instantiated and saved to the database before running your test.</p>
</div>
<div class="sect3">
<h4 id="strengths-2">Strengths</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.grails.org/Fixtures+Plugin">Fixture Plugin</a></p>
</li>
<li>
<p>Full control over values in every object in the object graph</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="weaknesses-2">Weaknesses</h4>
<div class="ulist">
<ul>
<li>
<p>Removes definition of testing data from test which can hurt test clarity.  Who knows how many family members the <code>johnsonFamily</code> fixture has and how many the <code>smithFamily</code> has?  You have to look at another file to find out.</p>
</li>
<li>
<p>Starts out well, but more and more tests start to rely on the same fixtures making them fragile.  "I&#8217;ll just add another Widget to this fixture" ends up breaking 10 other tests.</p>
</li>
<li>
<p>Any changes to domain objects necessitate modifying every fixture that has that domain object within the object graph</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features">Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Auto generation of grails property types, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Associated domain objects</p>
</li>
<li>
<p>Embedded domain objects</p>
</li>
<li>
<p>String</p>
</li>
<li>
<p>Date</p>
</li>
<li>
<p>Boolean</p>
</li>
<li>
<p>Numbers (Integer, Long, Float, Short, etc)</p>
</li>
<li>
<p>Byte</p>
</li>
<li>
<p>JodaTime classes</p>
</li>
<li>
<p>Any persistable class with a zero-argument constructor</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="supported-constraints">Supported Constraints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/nullable.html">nullable</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/blank.html">blank</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/creditCard.html">creditCard</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/email.html">email</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/inList.html">inList</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/max.html">max</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/maxSize.html">maxSize</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/min.html">min</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/minSize.html">minSize</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/range.html">range</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/size.html">size</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/url.html">url</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/matches.html">matches</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="unsupported-constraints">Unsupported Constraints</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/scale.html">scale</a></p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/validator.html">validator</a> - custom validators can have all kinds of business logic in them and there isn&#8217;t a programmatic way to interrogate this.  If the test value that&#8217;s tried doesn&#8217;t pass your logic, you&#8217;ll need to provide a value, or mock out the calls that the validator makes so that it passes.</p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/unique.html">unique</a> - not directly supported but it&#8217;s possible to specify your own unique value in a config file as demonstrated on the <a href="examples">Examples</a> page.</p>
</li>
<li>
<p><a href="http://grails.org/doc/latest/ref/Constraints/notEqual.html">notEqual</a> - unlikely that our test data would match this, could be supported in the future</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The test framework and testing methodology for Grails has undergone several major revisions over the past few releases.</p>
</div>
<div class="paragraph">
<p>Unfortunately, this makes it impossible to have one plugin which is compatible with all prior versions.</p>
</div>
<div class="sect2">
<h3 id="grails-5-0-or-later">Grails 5.0 or later</h3>
<div class="paragraph">
<p><code>testImplementation "io.github.longwa:build-test-data:5.0.0"</code></p>
</div>
</div>
<div class="sect2">
<h3 id="grails-4-0">Grails 4.0</h3>
<div class="paragraph">
<p><code>testCompile "org.grails.plugins:build-test-data:4.0.0"</code></p>
</div>
</div>
<div class="sect2">
<h3 id="grails-3-3">Grails 3.3</h3>
<div class="paragraph">
<p><code>testCompile "org.grails.plugins:build-test-data:3.3.1"</code></p>
</div>
</div>
<div class="sect2">
<h3 id="grails-3-1-and-3-2">Grails 3.1 and 3.2</h3>
<div class="paragraph">
<p><code>testCompile "org.grails.plugins:build-test-data:3.0.1"</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Version 3.0.x is required for Grails versions 3.0 through 3.2
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the legacy Wiki documentation for details:
<a href="https://github.com/longwa/build-test-data/wiki" class="bare">https://github.com/longwa/build-test-data/wiki</a></p>
</div>
</div>
<div class="sect2">
<h3 id="grails-2-x">Grails 2.x</h3>
<div class="paragraph">
<p>See the legacy Wiki documentation for details:
<a href="https://github.com/longwa/build-test-data/wiki" class="bare">https://github.com/longwa/build-test-data/wiki</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading">Upgrading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When upgrading from older versions of Grails, first follow the standard Grails upgrade process.</p>
</div>
<div class="sect2">
<h3 id="performance-improvements">Performance Improvements</h3>
<div class="paragraph">
<p>The core plugin has been refactored to reduce metaClass dependency and remove a few poor performing contructs (I&#8217;m looking at you ClassPathScanningCandidateComponentProvider).</p>
</div>
<div class="paragraph">
<p>Most of the plugin classes have also been converted to <code>@CompileStatic</code>. In addition, the DomainInstanceBuilder can be cached and re-used to prevent additional overhead.</p>
</div>
</div>
<div class="sect2">
<h3 id="abstract-classes">Abstract Classes</h3>
<div class="paragraph">
<p>Concrete subclasses are no longer discovered automatically. If you graph needs to build an abstract class, use the <code>abstractDefaults</code> parameter in <code>TestDataConfig</code> to specify a concrete subclass.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">abstractDefault = [
    <span class="string"><span class="delimiter">'</span><span class="content">test.AbstractBook</span><span class="delimiter">'</span></span>   : MyBook,
    <span class="string"><span class="delimiter">'</span><span class="content">test.AbstractAuthor</span><span class="delimiter">'</span></span> : Tolkien
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-parameters">Config Parameters</h3>
<div class="paragraph">
<p>Some test data config parameters such as <code>abstractDefault</code> and <code>sampleData</code> used to allow either a Class or String as the map key.</p>
</div>
<div class="paragraph">
<p>In 3.3 and later, only a full package name String is allowed.</p>
</div>
</div>
<div class="sect2">
<h3 id="disabling-via-testdataconfig">Disabling Via TestDataConfig</h3>
<div class="paragraph">
<p>You can no longer disable via the <code>testDataConfig.enabled = false</code> option.</p>
</div>
</div>
<div class="sect2">
<h3 id="build-methods-refactored">Build methods refactored</h3>
<div class="paragraph">
<p>They all go through static helpers in the TestData eventually
<code>buildLazy</code> &#8594; <code>findOrBuild</code> or <code>build(find:true)</code>
<code>buildWithoutSave</code> &#8594; <code>build(save: false)</code></p>
</div>
</div>
<div class="sect2">
<h3 id="unit-tests">Unit Tests</h3>
<div class="paragraph">
<p>Most of the work when upgrading to Grails 3.3.x will involve refactoring related to the framework itself with only minor changes for build-test-data.</p>
</div>
<hr>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Build</span>([Author])
<span class="type">class</span> <span class="class">AuthorSpec</span> <span class="directive">extends</span> Specification {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just add the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Build</span>([Author])
<span class="type">class</span> <span class="class">AuthorSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, use the standard Grails mock method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="type">void</span> setupSpec() {
        mockDomains(Author)
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or by overriding the <strong>getDomainClassesToMock</strong> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="predefined-type">Class</span><span class="type">[]</span> getDomainClassesToMock() {
        [Author]
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or use with the BuildDomainTest and generics</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDomainTest&lt;Author&gt;{
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure you use <strong>DomainUnitTest</strong> for unit tests and <strong>TestDataBuilder</strong> for integration tests.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="integration-tests">Integration Tests</h3>
<div class="paragraph">
<p>For integration tests, follow the standard Grails upgrade instructions and then add the <code>TestDataBuilder</code> trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">AuthorIntegrationSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> TestDataBuilder {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin should be able to generate simple to moderately complex objects and satisfy all of their constraints right out of the box without any additional configuration.</p>
</div>
<div class="sect2">
<h3 id="simple-application-example">Simple Application Example</h3>
<div class="paragraph">
<p>See the example/bookStore app for examples</p>
</div>
<div class="paragraph">
<p>Create an Author domain class:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails create-domain-class com.example.Author</pre>
</div>
</div>
<div class="paragraph">
<p>And give it the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bookstore

<span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="directive">static</span> constraints = {
        firstName(<span class="key">blank</span>: <span class="predefined-constant">false</span>)
        lastName(<span class="key">blank</span>: <span class="predefined-constant">false</span>)
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>firstName</span><span class="content"> </span><span class="inline"><span class="inline-delimiter">$</span>lastName</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a Book domain class:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails create-domain-class com.example.Book</pre>
</div>
</div>
<div class="paragraph">
<p>With these contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bookstore

<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">Date</span> published
    <span class="predefined-type">BigDecimal</span> price

    <span class="directive">static</span> belongsTo = [<span class="key">author</span>: Author]

    <span class="directive">static</span> constraints = {
        title(<span class="key">blank</span>: <span class="predefined-constant">false</span>)
        published(<span class="key">nullable</span>: <span class="predefined-constant">false</span>)
        price(<span class="key">nullable</span>: <span class="predefined-constant">false</span>, <span class="key">scale</span>: <span class="integer">2</span>, <span class="key">min</span>: <span class="float">5.95</span> <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>)
        author(<span class="key">nullable</span>: <span class="predefined-constant">false</span>)
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>title</span><span class="content"> published on </span><span class="inline"><span class="inline-delimiter">$</span>published</span><span class="content"> by </span><span class="inline"><span class="inline-delimiter">$</span>author</span><span class="content"> costs </span><span class="char">\$</span><span class="inline"><span class="inline-delimiter">$</span>price</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, load up the grails console and lets try build on our new domain objects:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails console</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build">build()</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">bookstore.Author</span>
<span class="keyword">import</span> <span class="include">grails.buildtestdata.TestData</span>

<span class="keyword">def</span> a = TestData.build(Author)

println <span class="string"><span class="delimiter">&quot;</span><span class="content">First Name: </span><span class="inline"><span class="inline-delimiter">$</span>a</span><span class="content">.firstName</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Last Name: </span><span class="inline"><span class="inline-delimiter">$</span>a</span><span class="content">.lastName</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Author ID: </span><span class="inline"><span class="inline-delimiter">$</span>a</span><span class="content">.id</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin will automatically create a new Author object, populate the required firstName and lastName fields, and save the object (giving it an id).  If you run the script, you should see output like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>First Name: firstName
Last Name: lastName
Author ID: 1</pre>
</div>
</div>
<div class="paragraph">
<p>By default, for String values, the plugin will just try to use the field name as the value (truncating or expanding as necessary if there are string length limitations).</p>
</div>
<div class="paragraph">
<p>If you want to specify the first name, just pass that in a map that you pass to build on the first line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>def a = TestData.build(Author, firstName: "Daniel")</pre>
</div>
</div>
<div class="paragraph">
<p>That modified script prints:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>First Name: Daniel
Last Name: lastName
Author ID: 2</pre>
</div>
</div>
<div class="paragraph">
<p>With Book, we have a more complex domain class.  It has a few different property types and it also has required related domain class of Author.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t care about any of the specific values on the book, you can simply call build() to have a valid, saved book instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">bookstore.*</span>

<span class="keyword">def</span> b = <span class="predefined-type">Book</span>.build()

println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book title: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.title</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book price: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.price</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book published: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.published</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book author: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.author</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book id: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.id</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Book title: title
Book price: 5.95
Book published: Mon Apr 13 23:11:34 CDT 2009
Book author: firstName lastName
Book id: 1
Book author id: 3</pre>
</div>
</div>
<div class="paragraph">
<p>Again, if you want to override some of the values, you can pass them in the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.example.*</span>

<span class="keyword">def</span> b = <span class="predefined-type">Book</span>.build(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tomorrow Midnight</span><span class="delimiter">&quot;</span></span>,
    <span class="key">author</span>: Author.build(<span class="key">firstName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ray</span><span class="delimiter">&quot;</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Bradbury</span><span class="delimiter">&quot;</span></span>)
)

println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book title: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.title</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book price: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.price</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book published: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.published</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book author: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.author</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book id: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.id</span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Book author id: </span><span class="inline"><span class="inline-delimiter">$</span>b</span><span class="content">.author.id</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Book title: Tomorrow Midnight
Book price: 5.95
Book published: Mon Apr 13 23:13:22 CDT 2009
Book author: Ray Bradbury
Book id: 2
Book author id: 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build-test-data plugin lets you concentrate on the data that&#8217;s pertinent to your test, rather than building and maintaing large datasets that aren&#8217;t tailor made for your test.</p>
</div>
</div>
<div class="sect2">
<h3 id="findorbuild">findOrBuild()</h3>
<div class="paragraph">
<p>Before creating an object (and it&#8217;s entire graph of required related objects) it will look to see if there&#8217;s already an object that meets the build criteria. If there is, it will return that, otherwise, it will create a new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Finds book created above with the existing author</span>
<span class="keyword">def</span> b = <span class="predefined-type">Book</span>.findOrBuild(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tomorrow Midnight</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">assert</span> b.author.lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bradbury</span><span class="delimiter">&quot;</span></span>

<span class="comment">// Creates new book with author</span>
<span class="keyword">def</span> newBook = <span class="predefined-type">Book</span>.findOrBuild(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">My Fancy New Book</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">assert</span> newBook != <span class="predefined-constant">null</span>
<span class="keyword">assert</span> newBook.author != <span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I find <code>findOrBuild()</code> to be really useful in grails console sessions where I want to create some dummy test data once and then do a number of operations on it. Previously, I had to comment out all the creation logic so that new objects weren&#8217;t getting created on every script execution. Now it&#8217;ll just return them and I can focus on writing the console code I wanted to try out rather than messing with the creation logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="buildsave-false">build(save: false)</h3>
<div class="paragraph">
<p>In some cases you need to build a domain object, but you don&#8217;t want to actually save it to the underlying data store.
This is particularly useful if you are trying to build a complex graph and need to build one of the children as part of the parent build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> author = Author.build(
    <span class="key">books</span>: [<span class="predefined-type">Book</span>.build(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Foo</span><span class="delimiter">'</span></span>, <span class="key">save</span>: <span class="predefined-constant">false</span>)]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have a complicated object graph, build with saving may not be necessary.
However, in cases where you might have a cycle in your graph, it can be necessary to successfully build the graph.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unittesting">Unit Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with Grails 3.3, unit testing is implemented via a set of traits that add support for testing the various artifacts types (Controllers, Services, Domains, etc.).</p>
</div>
<div class="paragraph">
<p>The build-test-data plugin uses the same approach by adding the:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>trait BuildDataTest</pre>
</div>
</div>
<div class="paragraph">
<p>This trait extends the built-in <code>DataTest</code> trait to setup the domain objects and domain graph for construction by build-test-data.</p>
</div>
<div class="paragraph">
<p>For unit tests, you can use the standard <code>getDomainClassesToMock</code> method to provide the top-level list of domain objects that are required by the test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookUnitSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span><span class="type">[]</span> getDomainClassesToMock() {
        [<span class="predefined-type">Book</span>] <span class="comment">// Author will be mocked automatically</span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">building a book will also build an author</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> book = <span class="predefined-type">Book</span>.build()

        <span class="key">then</span>:
        book.author != <span class="predefined-constant">null</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or it can be done in setupSpec</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LibraryUnitSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="type">void</span> setupSpec(){
        mockDomains(<span class="predefined-type">Book</span>, Magazine)
    }
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You don&#8217;t have to explicitly declare that you are building an Author if Book has a dependency there, build-test-data will figure that out for you and tells Grails to mock it automatically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This plugin also provide a <code>BuildDomainTest</code> trait as a replacement to the <code>grails.testing.gorm.DomainUnitTest</code>
that allows the use of generics like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookUnitSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDomainTest&lt;<span class="predefined-type">Book</span>&gt; {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">building a book will also build an author</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        domain.name
        domain.author
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">building and author will build a book</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> author = build(Author)

        <span class="key">expect</span>:
        author.name
        author.book
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="using-build">Using @Build</h3>
<div class="paragraph">
<p>Alternately, you can continue to use the legacy build-test-data <code>@Build</code> annotation to specify classes to mock. The <code>@Build</code> annotation currently has the added bonus of supporting code completion in some editors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Build</span>([<span class="predefined-type">Book</span>])
<span class="type">class</span> <span class="class">BookUnitSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">building a book will also build an author</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> book = <span class="predefined-type">Book</span>.build()

        <span class="key">then</span>:
        book.author != <span class="predefined-constant">null</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if you are using the <code>@Build</code> annotation, you must still implement the <code>BuildDataTest</code> trait.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="trait-methods">Trait Methods</h3>
<div class="paragraph">
<p>The <code>TestDataBuilder</code> and therefore the <code>BuildDataTest</code> trait adds the builder methods to your test class if you prefer to call them directly.
These call out to statics in the <code>TestData</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="directive">public</span> &lt;T&gt; T build(<span class="predefined-type">Map</span> args = [:], <span class="predefined-type">Class</span>&lt;T&gt; clazz) {
        TestData.build(args, clazz)
    }

    <span class="directive">public</span> &lt;T&gt; T build(<span class="predefined-type">Class</span>&lt;T&gt; clazz, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; propValues) {
        TestData.build([:], clazz, propValues)
    }

    <span class="directive">public</span> &lt;T&gt; T build(<span class="predefined-type">Map</span> args, <span class="predefined-type">Class</span>&lt;T&gt; clazz, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; propValues) {
        TestData.build(args, clazz, propValues)
    }

    <span class="directive">public</span> &lt;T&gt; T findOrBuild(<span class="predefined-type">Class</span>&lt;T&gt; clazz, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; propValues = [:]) {
        TestData.build([<span class="key">find</span>: <span class="predefined-constant">true</span>], clazz, propValues)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case you can just call <code>build()</code> and pass in the Class that you which to build or call the TestData methods directly.
See the groovyDocs on the TestData for more details</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookUnitSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> BuildDataTest {
    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span><span class="type">[]</span> getDomainClassesToMock() {
        [<span class="predefined-type">Book</span>]
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">building a book using the trait method</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> book = build(<span class="predefined-type">Book</span>, [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book Title</span><span class="delimiter">'</span></span>])

        <span class="key">then</span>:
        book.author != <span class="predefined-constant">null</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hibernatespec-multi-tenant">HibernateSpec Multi-Tenant</h3>
<div class="paragraph">
<p>Multi-Tenant example test using HibernateSpec</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">grails.buildtestdata.TestData</span>

<span class="comment">//TestDataBuilder will take care of before to load configuratio and after methods to clear cache</span>
<span class="type">class</span> <span class="class">MultiTenantHibernateSpec</span> <span class="directive">extends</span> HibernateSpec <span class="directive">implements</span> TestDataBuilder {

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&gt; getDomainClasses() {
        [Foo, Bar]
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">Map</span> getConfiguration() {
        [(Settings.SETTING_MULTI_TENANT_RESOLVER_CLASS)           : SystemPropertyLongTenantResolver,
         (Settings.SETTING_MULTI_TENANCY_MODE)                    : <span class="string"><span class="delimiter">'</span><span class="content">DISCRIMINATOR</span><span class="delimiter">'</span></span>,
         (org.grails.orm.hibernate.cfg.Settings.SETTING_DB_CREATE): <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>]
    }

    <span class="keyword">def</span> <span class="function">cleanupSpec</span>() {
        <span class="predefined-type">System</span>.setProperty(SystemPropertyLongTenantResolver.PROPERTY_NAME, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Do some test</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">when</span>:
        <span class="keyword">def</span> foo = build(Foo)

        <span class="key">then</span>:
        foo.id
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Do some test</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">when</span>:
        <span class="comment">//Call on TestData directly</span>
        <span class="keyword">def</span> bar = TestData.build(Bar, <span class="key">save</span>: <span class="predefined-constant">false</span>)

        <span class="key">then</span>:
        !bar.id
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrationtesting">Integration Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integration tests don&#8217;t require the same type of setup as Unit Tests since the Grails environment is fully bootstrapped.</p>
</div>
<div class="paragraph">
<p>The plugin includes a trait that should be mixed into Integration tests to provide additional functionality:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>trait TestDataBuilder</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The trait is not strictly required, but it does include some setup and cleanup functionality that could be useful in some cases. Additional functionality may be added in the future via this trait, so implementing it is preferred.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="using-build-annotation">Using Build Annotation</h3>
<div class="paragraph">
<p>In prior versions, the <code>@Build</code> annotation was <strong>strictly</strong> for Unit Tests (it would cause numerous issues when used on integration tests, which was a common source of confusion on our projects).</p>
</div>
<div class="paragraph">
<p>Starting with build-test-data 3.3, the <code>@Build</code> annotation can be used safely on integration tests. The primary reason to use it would be to take advantage of IDE autocomplete for properties when calling the <code>DomainObject.build()</code> method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testdataconfig">Test Data Config</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to specify global defaults, you will need to create a <code>TestDataConfig.groovy</code> (using the examples below as a starting point):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>src/test/resources/TestDataConfig.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>The config file is most useful when you are building a class that has dependencies on an entire object graph and you want to be able to control some of the values in the object graph that gets created automatically.</p>
</div>
<div class="paragraph">
<p>For example, if you&#8217;re building a Book, and a Book has an Author which has a Publisher.  If you want to control the name of the publisher (without manually creating the entire object graph by hand), you can instead specify in the config file that when publishers are created, they should be named X:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testDataConfig {
        sampleData {
            <span class="string"><span class="delimiter">'</span><span class="content">com.example.Publisher</span><span class="delimiter">'</span></span> {
                name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Pragmatic Bookshelf</span><span class="delimiter">&quot;</span></span>
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, when you build a Book, the Publisher is named appropriately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">assert</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Pragmatic Bookshelf</span><span class="delimiter">&quot;</span></span> == <span class="predefined-type">Book</span>.build().author.publisher.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the config&#8217;s sampleData closure, you specify a domain class name.  Use quotes around the fully qualified class name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Prior versions allowed a <strong>Class</strong> as a key for sampleData, but that is not longer supported. You must specify the entity name as a fully qualified <strong>String</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each class specified, you can then provide the properties that you&#8217;d like populated and give it a property value to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testDataConfig {
        sampleData {
            <span class="string"><span class="delimiter">'</span><span class="content">com.example.Hotel</span><span class="delimiter">'</span></span> {
                name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hilton</span><span class="delimiter">&quot;</span></span>
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using that config file in a test for a com.example.Hotel domain object with a name property would produce the following results in a test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    println Hotel.build().name   <span class="comment">// prints &quot;Hilton&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It follows the normal groovy config file pattern and you can also override things at an environmental level if desired.  This example shows how in development we can return "Motel 6" but production will return "Hilton".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testDataConfig {
        sampleData {
                <span class="string"><span class="delimiter">'</span><span class="content">com.example.Hotel</span><span class="delimiter">'</span></span> {
                    name =<span class="string"><span class="delimiter">&quot;</span><span class="content">Motel 6</span><span class="delimiter">&quot;</span></span>
                }
        }
    }
    environments {
        production {
            testDataConfig {
                sampleData {
                    <span class="string"><span class="delimiter">'</span><span class="content">com.example.Hotel</span><span class="delimiter">'</span></span> {
                        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hilton</span><span class="delimiter">&quot;</span></span>
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are not required to have a TestDataConfig.groovy file.</p>
</div>
<div class="sect2">
<h3 id="test-specific-config">Test Specific Config</h3>
<div class="paragraph">
<p>It&#8217;s also possible to specify a config that is used during a particular test.</p>
</div>
<div class="paragraph">
<p>Your test should implement the <code>TestDataBuilder</code> for integration tests or <code>BuildDataTest</code> for unit tests. Just override the <code>doWithTestDataConfig</code> method and return a Closure just like your <code>TestDataConfig.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    Closure doWithTestDataConfig() {{-&gt;
        testDataConfig {
            sampleData {
                <span class="string"><span class="delimiter">'</span><span class="content">config.Hotel</span><span class="delimiter">'</span></span> {
                    name = {-&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Westin</span><span class="delimiter">&quot;</span></span> }
                }
            }
        }
    }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will merge the config provided from this method with the global configuration (if any) in <code>TestDataConfig.groovy</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration is merged at the entity level, not the attribute level. In the above example, the global sample data for the <code>'config.Hotel'</code> entity will be completely replaced by this configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After using this method, you&#8217;ll likely want to call <code>TestDataConfigurationHolder.reset()</code> to put the configuration back to the normal config file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="type">void</span> cleanup() {
        TestDataConfigurationHolder.reset()
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generating-dynamic-values">Generating Dynamic Values</h3>
<div class="paragraph">
<p>If you have a need to have different values given to a domain object (possibly for a unique constraint), you can instead specify a closure in your config file.  This closure will be called and is expected to return the property value.  Here&#8217;s an example that generates a unique title for a book:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testDataConfig {
        sampleData {
            <span class="string"><span class="delimiter">'</span><span class="content">com.foo.Book</span><span class="delimiter">'</span></span> {
                <span class="keyword">def</span> i = <span class="integer">1</span>
                title = {-&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="inline"><span class="inline-delimiter">${</span>i++<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }   <span class="comment">// creates &quot;title1&quot;, &quot;title2&quot;, ....&quot;titleN&quot;</span>
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>One thing to watch out for with this is that if your tests are expecting particular values generated by the closure, you could run into sequencing effects if your test run out of order (or you add a new test).  To get around this, you can reset the config before you run the test.  This is a good idea if you&#8217;re using dynamic values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setup() {
    TestDataConfigurationHolder.reset()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a <code>Closure</code> is used as an attribute, it can additionally take 1 or 2 parameters. The first parameter is a <code>Map</code> of all of the properties that have been resolved so far. This allows you to configure defaults based on the values of other properties given or defaulted on the object. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'</span><span class="content">config.Hotel</span><span class="delimiter">'</span></span>: {
    <span class="key">name</span>: { -&gt;
        i++ % <span class="integer">2</span> == <span class="integer">0</span> ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Holiday Inn</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hilton</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key">faxNumber</span>: { values -&gt;
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Fax number for </span><span class="inline"><span class="inline-delimiter">$</span>values</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second parameter is the instance that is currently being built. In the above example, that would be the new (unsaved) instance of <code>Hotel</code>. This is useful if you want to build associated data and you need a reference to the parent object. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'</span><span class="content">bookstore.Author</span><span class="delimiter">'</span></span>: {
    <span class="key">books</span>: { values, obj -&gt; [<span class="predefined-type">Book</span>.build(<span class="key">save</span>: <span class="predefined-constant">false</span>, <span class="key">author</span>: obj, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">James</span><span class="delimiter">'</span></span>)] }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the transient <code>obj</code> instance is needed so that the <code>Book</code> instance can associate back to the parent.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this case, you must use the [save: false] argument, otherwise build test data will attempt to save the <code>Book</code> and fail with a transient object exception on <code>Author</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="specifying-additional-dependencies">Specifying Additional Dependencies</h3>
<div class="paragraph">
<p>Occasionally it is necessary to build another object manually in your <code>TestDataConfig</code> file. Usually this will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="string"><span class="delimiter">'</span><span class="content">test.Book</span><span class="delimiter">'</span></span> {
        author = {-&gt; Author.build() }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of reasons that you might want to do this. For complex object graphs, this may be necessary to prevent failures due to loops in the graph.
Also, for some graphs, you may need to do a build(save: false) or a findOrBuild() for a particular association. It may also just be that you want to default an optional association, since build-test-data will only build out the graph for required properties.</p>
</div>
<div class="paragraph">
<p>Regardless, this introduces a hidden dependency when building the <code>Book</code> class. If you only have <code>@Build([Book])</code> in your test case, you&#8217;ll likely get a MethodMissing exception building <code>Author</code>. To resolve this issue, you may specify additional objects to mock each time Book is mocked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">unitAdditionalBuild = [<span class="string"><span class="delimiter">'</span><span class="content">test.Book</span><span class="delimiter">'</span></span>: [test.Author]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each key is the full package name of a domain object and the value is a List of either a Class or String indicating additional domains to include whenever the key object is built.</p>
</div>
<div class="paragraph">
<p>The chain is recursive in that Author could, itself, have additional dependencies.  So if <code>Book</code> <code>belongsTo</code> an <code>Author</code> which <code>belongsTo</code> a <code>Publisher</code>, <code>build`ing a `Book</code> would give you all three without explicitly saying that a <code>Book</code> needs a <code>Publisher</code> with this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">unitAdditionalBuild = [
    <span class="string"><span class="delimiter">'</span><span class="content">test.Book</span><span class="delimiter">'</span></span>     : [test.Author],
    <span class="string"><span class="delimiter">'</span><span class="content">test.Author</span><span class="delimiter">'</span></span>   : [test.Publisher]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, this is only needed for Unit testing as Grails includes all domain objects, by default, for integration tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="building-abstract-classes">Building Abstract Classes</h3>
<div class="paragraph">
<p>If your domain classes reference abstract classes, build test data needs to know which concrete class to build to satisfy the dependencies.</p>
</div>
<div class="paragraph">
<p>By using the <code>abstractDefault</code> configuration option, you can override this behavior globally to indicate which specific subclass is desired for a given base class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    abstractDefault = [
        <span class="string"><span class="delimiter">'</span><span class="content">test.AbstractBook</span><span class="delimiter">'</span></span>   : MyBook,
        <span class="string"><span class="delimiter">'</span><span class="content">test.AbstractAuthor</span><span class="delimiter">'</span></span> : Tolkien
    ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, any time BTD needs to build an <code>AbstractBook</code>, it will build an instance of <code>MyBook</code> by default. If you only want to override the subclass for a particular domain object, you may want to consider just adding a default value in <code>sampleData</code>.</p>
</div>
<div class="paragraph">
<p>This default will also apply if you manually build an instance of an abstract class. For example, calling <code>AbstractBook.build()</code> in this example will return a <code>MyBook</code> instance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Behavior Change</div>
Prior to version 3.3, build-test-data would automatically try to find a concrete subclass. However, this was <strong>horribly</strong> slow as Java makes it very difficult to accomplish this task. For this reason, it&#8217;s now required to use <code>abstractDefaults</code> when subclasses are required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-a-different-name-for-testdataconfig-groovy">Using a different name for TestDataConfig.groovy</h3>
<div class="paragraph">
<p>In some cases you need to have a different name for <code>TestDataConfig.groovy</code>. The reason could be, that you have project that depends on several inline plugins all using this plugin. If all plugins contains <code>TestDataConfig.groovy</code> you will end up with a compile error saying that <code>TestDataConfig.groovy</code> is duplicated in your classpath.</p>
</div>
<div class="paragraph">
<p>Using a different name by setting this in application.groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.buildtestdata.testDataConfig = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyTestDataConfig</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With Grails 3, you would add to application.yml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml">    <span class="key">grails</span>:
        <span class="key">buildtestdata</span>:
            <span class="key">testDataConfig</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MyTestDataConfig</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and rename your <code>TestDataConfig.groovy</code> to <code>MyTestDataConfig.groovy</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have the plugin installed, it should be as easy as calling <code>build()</code> on any of your domain objects in your tests.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t pass any parameters to build, it will attempt to provide values for all of the properties that it determines have required values based on the constraints.  This includes other domain objects.</p>
</div>
<div class="paragraph">
<p>If you want to specify particular values, you can pass build a map (just like you can to a domain object constructor).  The plugin will attempt to create new values for any required properties that you don&#8217;t specify in the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">domainObject.build(<span class="key">myProperty</span>:<span class="string"><span class="delimiter">'</span><span class="content">myPropertyValue</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build method default is to attempt to save the populated domain object. You can avoid saving the object first by calling the buildWithoutSave method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">domainObject.buildWithoutSave(<span class="key">myProperty</span>:<span class="string"><span class="delimiter">'</span><span class="content">myPropertyValue</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="working-with-unique-constraints">Working with Unique Constraints</h3>
<div class="paragraph">
<p>There currently isn&#8217;t built-in support for uniqueness constraints, but it&#8217;s pretty easy to get this working using a closure in the config file to generate a series of unique values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testDataConfig {
    sampleData {
        <span class="string"><span class="delimiter">'</span><span class="content">com.foo.Book</span><span class="delimiter">'</span></span> {
             <span class="keyword">def</span> i = <span class="integer">1</span>
             title = {-&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="inline"><span class="inline-delimiter">${</span>i++<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }   <span class="comment">// creates &quot;title1&quot;, &quot;title2&quot;,...</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your test cares about this unique value, you&#8217;ll likely want to reset the configuration either directly in your test or in the setUp of the test.  Otherwise, other tests could have grabbed the value that you were expecting. To reset the configuration back to the original state, use this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">TestDataConfigurationHolder.reset()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-objects-and-building-associated-child-objects">Building Objects and Building Associated Child Objects</h3>
<div class="paragraph">
<p>When you have a parent object that you want to have specific child objects, here&#8217;s one way this can be done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Issue</span> {
    <span class="predefined-type">String</span> title
    <span class="directive">static</span> hasMany = [<span class="key">pages</span>: Page]
}

<span class="type">class</span> <span class="class">Page</span> {
    <span class="predefined-type">Integer</span> number
    <span class="directive">static</span> hasMany = [<span class="key">advertisments</span>: Advertisment]
    <span class="directive">static</span> belongsTo = [<span class="key">issue</span>: Issue]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create an issue and then give it pages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Build the issue first</span>
<span class="keyword">def</span> issue = Issue.build()

(<span class="integer">1</span>..<span class="integer">5</span>).collect { Page.build(<span class="key">issue</span>: issue, <span class="key">number</span>: <span class="local-variable">it</span>) }

<span class="comment">// Pages are automatically added to the issue's hasMany pages collection</span>
assertEquals <span class="integer">5</span>, issue.pages.size()

<span class="comment">// Don't build extra issues when building pages</span>
assertEquals <span class="integer">1</span>, Issue.list().size()</code></pre>
</div>
</div>
<div class="paragraph">
<p>We don&#8217;t want to build the Page objects before we have the Issue otherwise the build method will create dummy issues in the database for each page (and that last assert would fail).</p>
</div>
</div>
<div class="sect2">
<h3 id="assigning-system-wide-default-values">Assigning System Wide Default Values</h3>
<div class="paragraph">
<p>Having build assign system wide default property values, or give values to classes that are "distant" in the object graph from the object you&#8217;re building can all be done with the <a id="TestDataConfig"></a> configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="logging-information">Logging Information</h3>
<div class="paragraph">
<p>If you want to see the detail of what objects the plugin is trying to save, you can set the logging level for the DomainTestDataService and the DomainInstanceBuilder to info.  Just stick this line in your 'logback.groovy'</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">grails.buildtestdata.DomainInstanceBuilder</span><span class="delimiter">&quot;</span></span>, INFO)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to see all of the gory detail about what the plugin is doing as it traverses the object graph and examines each property, set the logging level to debug and add in the property handlers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">grails.buildtestdata</span><span class="delimiter">&quot;</span></span>, DEBUG)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 5.0.0<br>
Last updated 2021-11-11 16:45:37 -0500
</div>
</div>
</body>
</html>